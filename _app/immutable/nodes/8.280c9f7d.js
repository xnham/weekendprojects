import{S as qe,T as He,U as oe,V as Ne,s as De,f as k,g,h as z,d,j as m,i as D,W as Ae,o as Ie,e as B,M as Re,a as N,r as X,c as A,w as _,x as Fe,y,l as W,m as O,n as G,C as We,G as Oe,q as me}from"../chunks/scheduler.90cbc393.js";import{g as Q,t as q,c as Z,a as S,S as Le,i as Se,b as se,d as ue,m as le,e as ae,f as ve}from"../chunks/index.f2611f2d.js";import{m as Ue}from"../chunks/metadataStore.410d5ae1.js";import{e as ke}from"../chunks/each.23f806c3.js";import{f as ge}from"../chunks/index.f9edecbc.js";import{supabase as je}from"../chunks/supabase.977684e5.js";import{I as be}from"../chunks/InteractionButton.c0953185.js";import{i as Be,s as Je,C as ce,t as Ye,g as ye,r as Ge}from"../chunks/essayInteractionService.09dd6a5d.js";function Ke(o,e){const r=e.token={};function t(n,a,s,c){if(e.token!==r)return;e.resolved=c;let l=e.ctx;s!==void 0&&(l=l.slice(),l[s]=c);const u=n&&(e.current=n)(l);let p=!1;e.block&&(e.blocks?e.blocks.forEach((b,v)=>{v!==a&&b&&(Q(),q(b,1,1,()=>{e.blocks[v]===b&&(e.blocks[v]=null)}),Z())}):e.block.d(1),u.c(),S(u,1),u.m(e.mount(),e.anchor),p=!0),e.block=u,e.blocks&&(e.blocks[a]=u),p&&Ne()}if(qe(o)){const n=He();if(o.then(a=>{oe(n),t(e.then,1,e.value,a),oe(null)},a=>{if(oe(n),t(e.catch,2,e.error,a),oe(null),!e.hasCatch)throw a}),e.current!==e.pending)return t(e.pending,0),!0}else{if(e.current!==e.then)return t(e.then,1,e.value,o),!0;e.resolved=o}}function Xe(o,e,r){const t=e.slice(),{resolved:n}=o;o.current===o.then&&(t[o.value]=n),o.current===o.catch&&(t[o.error]=n),o.block.p(t,r)}function Qe(){return{}}const Ct=Object.freeze(Object.defineProperty({__proto__:null,load:Qe},Symbol.toStringTag,{value:"Module"}));function we(o,e,r){const t=o.slice();return t[15]=e[r],t}function Ze(o){let e,r,t=ke(o[0]),n=[];for(let s=0;s<t.length;s+=1)n[s]=Ce(we(o,t,s));const a=s=>q(n[s],1,1,()=>{n[s]=null});return{c(){for(let s=0;s<n.length;s+=1)n[s].c();e=B()},l(s){for(let c=0;c<n.length;c+=1)n[c].l(s);e=B()},m(s,c){for(let l=0;l<n.length;l+=1)n[l]&&n[l].m(s,c);D(s,e,c),r=!0},p(s,c){if(c&249){t=ke(s[0]);let l;for(l=0;l<t.length;l+=1){const u=we(s,t,l);n[l]?(n[l].p(u,c),S(n[l],1)):(n[l]=Ce(u),n[l].c(),S(n[l],1),n[l].m(e.parentNode,e))}for(Q(),l=t.length;l<n.length;l+=1)a(l);Z()}},i(s){if(!r){for(let c=0;c<t.length;c+=1)S(n[c]);r=!0}},o(s){n=n.filter(Boolean);for(let c=0;c<n.length;c+=1)q(n[c]);r=!1},d(s){s&&d(e),Re(n,s)}}}function xe(o){let e,r,t="No essays found. Please check your database connection or create some essays.",n,a,s,c="Debug Essays Data",l,u;return{c(){e=k("div"),r=k("p"),r.textContent=t,n=N(),a=k("div"),s=k("button"),s.textContent=c,this.h()},l(p){e=g(p,"DIV",{class:!0});var b=z(e);r=g(b,"P",{"data-svelte-h":!0}),X(r)!=="svelte-syp6t2"&&(r.textContent=t),n=A(b),a=g(b,"DIV",{class:!0});var v=z(a);s=g(v,"BUTTON",{class:!0,"data-svelte-h":!0}),X(s)!=="svelte-p33n27"&&(s.textContent=c),v.forEach(d),b.forEach(d),this.h()},h(){m(s,"class","svelte-11wzf28"),m(a,"class","debug-actions svelte-11wzf28"),m(e,"class","no-essays svelte-11wzf28")},m(p,b){D(p,e,b),_(e,r),_(e,n),_(e,a),_(a,s),l||(u=Fe(s,"click",o[9]),l=!0)},p:y,i:y,o:y,d(p){p&&d(e),l=!1,u()}}}function et(o){let e,r,t;return{c(){e=k("div"),r=W("Error: "),t=W(o[2]),this.h()},l(n){e=g(n,"DIV",{class:!0});var a=z(e);r=O(a,"Error: "),t=O(a,o[2]),a.forEach(d),this.h()},h(){m(e,"class","error-state svelte-11wzf28")},m(n,a){D(n,e,a),_(e,r),_(e,t)},p(n,a){a&4&&G(t,n[2])},i:y,o:y,d(n){n&&d(e)}}}function tt(o){let e,r="Loading essays...";return{c(){e=k("div"),e.textContent=r,this.h()},l(t){e=g(t,"DIV",{class:!0,"data-svelte-h":!0}),X(e)!=="svelte-14u9k9t"&&(e.textContent=r),this.h()},h(){m(e,"class","loading-state svelte-11wzf28")},m(t,n){D(t,e,n)},p:y,i:y,o:y,d(t){t&&d(e)}}}function rt(o){let e=o[15].description+"",r;return{c(){r=W(e)},l(t){r=O(t,e)},m(t,n){D(t,r,n)},p(t,n){n&1&&e!==(e=t[15].description+"")&&G(r,e)},d(t){t&&d(r)}}}function nt(o){let e=o[15].excerpt+"",r;return{c(){r=W(e)},l(t){r=O(t,e)},m(t,n){D(t,r,n)},p(t,n){n&1&&e!==(e=t[15].excerpt+"")&&G(r,e)},d(t){t&&d(r)}}}function Ee(o){let e,r,t,n;return{c(){e=k("div"),r=W(o[3]),this.h()},l(a){e=g(a,"DIV",{class:!0});var s=z(e);r=O(s,o[3]),s.forEach(d),this.h()},h(){m(e,"class","copy-feedback svelte-11wzf28")},m(a,s){D(a,e,s),_(e,r),n=!0},p(a,s){(!n||s&8)&&G(r,a[3])},i(a){n||(a&&We(()=>{n&&(t||(t=ve(e,ge,{duration:150},!0)),t.run(1))}),n=!0)},o(a){a&&(t||(t=ve(e,ge,{duration:150},!1)),t.run(0)),n=!1},d(a){a&&d(e),a&&t&&t.end()}}}function $e(o){let e=ze(o[15])+"",r;return{c(){r=W(e)},l(t){r=O(t,e)},m(t,n){D(t,r,n)},p(t,n){n&1&&e!==(e=ze(t[15])+"")&&G(r,e)},d(t){t&&d(r)}}}function Ce(o){let e,r,t,n,a=Te(o[15].date)+"",s,c,l,u=o[15].title+"",p,b,v,C,V,J='<span class="read-more-text svelte-11wzf28">Read more</span> &gt;',P,U,i,f,h,w,E,I,K,H,R,ie,Y;function fe(T,L){return T[15].excerpt?nt:rt}let ee=fe(o),F=ee(o);function Ve(...T){return o[10](o[15],...T)}h=new be({props:{type:"like",active:o[5][o[15].id]||!1,count:void 0}}),h.$on("click",Ve);function Pe(...T){return o[11](o[15],...T)}I=new be({props:{type:"share",active:!1,count:void 0}}),I.$on("click",Pe);let $=o[3]&&o[4]===o[15].id&&Ee(o),M=o[15].id&&$e(o);return{c(){e=k("div"),r=k("a"),t=k("div"),n=k("p"),s=W(a),c=N(),l=k("h3"),p=W(u),b=N(),v=k("p"),F.c(),C=N(),V=k("span"),V.innerHTML=J,U=N(),i=k("div"),f=k("div"),se(h.$$.fragment),w=N(),E=k("div"),se(I.$$.fragment),K=N(),$&&$.c(),H=N(),R=k("div"),M&&M.c(),ie=N(),this.h()},l(T){e=g(T,"DIV",{class:!0});var L=z(e);r=g(L,"A",{href:!0,class:!0,"data-sveltekit-preload-data":!0});var x=z(r);t=g(x,"DIV",{class:!0});var j=z(t);n=g(j,"P",{class:!0});var de=z(n);s=O(de,a),de.forEach(d),c=A(j),l=g(j,"H3",{class:!0});var he=z(l);p=O(he,u),he.forEach(d),b=A(j),v=g(j,"P",{class:!0});var _e=z(v);F.l(_e),_e.forEach(d),C=A(j),V=g(j,"SPAN",{class:!0,"data-svelte-h":!0}),X(V)!=="svelte-wq4u18"&&(V.innerHTML=J),j.forEach(d),x.forEach(d),U=A(L),i=g(L,"DIV",{class:!0});var te=z(i);f=g(te,"DIV",{class:!0});var re=z(f);ue(h.$$.fragment,re),w=A(re),E=g(re,"DIV",{class:!0});var ne=z(E);ue(I.$$.fragment,ne),K=A(ne),$&&$.l(ne),ne.forEach(d),re.forEach(d),H=A(te),R=g(te,"DIV",{class:!0});var pe=z(R);M&&M.l(pe),pe.forEach(d),te.forEach(d),ie=A(L),L.forEach(d),this.h()},h(){m(n,"class","essay-date svelte-11wzf28"),m(l,"class","essay-title svelte-11wzf28"),m(v,"class","essay-description"),m(V,"class","read-more svelte-11wzf28"),m(t,"class","essay-content svelte-11wzf28"),m(r,"href",P="/writing/"+o[15].slug),m(r,"class","essay-card-link svelte-11wzf28"),m(r,"data-sveltekit-preload-data","off"),m(E,"class","share-button-container svelte-11wzf28"),m(f,"class","essay-buttons svelte-11wzf28"),m(R,"class","essay-counters svelte-11wzf28"),m(i,"class","essay-interaction-container svelte-11wzf28"),m(e,"class","essay-card svelte-11wzf28")},m(T,L){D(T,e,L),_(e,r),_(r,t),_(t,n),_(n,s),_(t,c),_(t,l),_(l,p),_(t,b),_(t,v),F.m(v,null),_(t,C),_(t,V),_(e,U),_(e,i),_(i,f),le(h,f,null),_(f,w),_(f,E),le(I,E,null),_(E,K),$&&$.m(E,null),_(i,H),_(i,R),M&&M.m(R,null),_(e,ie),Y=!0},p(T,L){o=T,(!Y||L&1)&&a!==(a=Te(o[15].date)+"")&&G(s,a),(!Y||L&1)&&u!==(u=o[15].title+"")&&G(p,u),ee===(ee=fe(o))&&F?F.p(o,L):(F.d(1),F=ee(o),F&&(F.c(),F.m(v,null))),(!Y||L&1&&P!==(P="/writing/"+o[15].slug))&&m(r,"href",P);const x={};L&33&&(x.active=o[5][o[15].id]||!1),h.$set(x),o[3]&&o[4]===o[15].id?$?($.p(o,L),L&25&&S($,1)):($=Ee(o),$.c(),S($,1),$.m(E,null)):$&&(Q(),q($,1,1,()=>{$=null}),Z()),o[15].id?M?M.p(o,L):(M=$e(o),M.c(),M.m(R,null)):M&&(M.d(1),M=null)},i(T){Y||(S(h.$$.fragment,T),S(I.$$.fragment,T),S($),Y=!0)},o(T){q(h.$$.fragment,T),q(I.$$.fragment,T),q($),Y=!1},d(T){T&&d(e),F.d(),ae(h),ae(I),$&&$.d(),M&&M.d()}}}function ot(o){let e,r,t,n;const a=[tt,et,xe,Ze],s=[];function c(l,u){return l[1]?0:l[2]?1:!l[0]||l[0].length===0?2:3}return r=c(o),t=s[r]=a[r](o),{c(){e=k("div"),t.c(),this.h()},l(l){e=g(l,"DIV",{class:!0});var u=z(e);t.l(u),u.forEach(d),this.h()},h(){m(e,"class","essays svelte-11wzf28")},m(l,u){D(l,e,u),s[r].m(e,null),n=!0},p(l,[u]){let p=r;r=c(l),r===p?s[r].p(l,u):(Q(),q(s[p],1,1,()=>{s[p]=null}),Z(),t=s[r],t?t.p(l,u):(t=s[r]=a[r](l),t.c()),S(t,1),t.m(e,null))},i(l){n||(S(t),n=!0)},o(l){q(t),n=!1},d(l){l&&d(e),s[r].d()}}}function Te(o){const[e,r,t]=o.split("-"),n=["January","February","March","April","May","June","July","August","September","October","November","December"],a=parseInt(r,10)-1,s=n[a],c=t.startsWith("0")?t.substring(1):t;return`${s} ${c}, ${e}`}function ze(o){const e=o.like_count||0,r=o.share_count||0;return e===0&&r===0?"":e>0&&r===0?`${e} ${e===1?"like":"likes"}`:e===0&&r>0?`${r} ${r===1?"share":"shares"}`:`${e} ${e===1?"like":"likes"} & ${r} ${r===1?"share":"shares"}`}function st(o,e,r){const t=Ae();let n=[],a=!0,s=null,c="",l="",u=null,p={likes:{},shares:{},views:{}},b={};async function v(){try{console.log("Loading essays from Supabase...");const{data:i,error:f}=await je.from("essays").select(`
          id, title, description, date, published, excerpt, slug,
          like_count, share_count, view_count
        `).eq("published",!0).order("date",{ascending:!1});if(f)throw f;console.log(`Successfully loaded ${(i==null?void 0:i.length)||0} essays from Supabase`),r(0,n=i||[]),r(1,a=!1)}catch(i){console.error("Error loading essays:",i),r(2,s=i instanceof Error?i.message:"Failed to load essays"),r(1,a=!1),t("error",i)}}Ie(()=>{console.log("Initializing interactions on Essays component");let i=()=>{},f=null;try{f=setTimeout(async()=>{try{const w=await Be();if(console.log("Interactions initialized with device ID:",w),!w){console.error("Failed to initialize interactions - no device ID returned"),t("error",new Error("Failed to initialize interactions"));return}await v(),i=Je(E=>{console.log("Interaction state updated",E),r(8,p=E)})}catch(w){console.error("Error during delayed interaction initialization:",w),t("error",w)}},300);const h=w=>{w.key==="Escape"&&(r(3,c=""),r(4,l=""))};return window.addEventListener("keydown",h),()=>{f&&clearTimeout(f),i(),window.removeEventListener("keydown",h),u&&clearTimeout(u)}}catch(h){return console.error("Error setting up Essays component:",h),t("error",h),()=>{f&&clearTimeout(f),i(),u&&clearTimeout(u)}}});async function C(i){console.log("handleLike called with essayId:",i);try{const f=n.find(H=>H.id===i);if(!f)return;const h=`${ce.ESSAY}:${i}`,E=(p==null?void 0:p.likes[h])||!1?-1:1,I=f.like_count||0,K=Math.max(0,I+E);f.like_count=K,console.log(`Optimistic update - like count for essay ${i}: ${I} → ${K}`),await Ye(i);try{const H=await ye(i);console.log(`Database counts for essay ${i}:`,H),r(0,n=n.map(R=>R.id===i?{...R,like_count:H.likeCount,share_count:H.shareCount,view_count:H.viewCount}:R))}catch(H){console.error("Error refreshing essay counts:",H)}}catch(f){console.error("Error toggling like:",f),t("error",f);const h=n.find(w=>w.id===i);if(h){const w=`${ce.ESSAY}:${i}`,I=(p==null?void 0:p.likes[w])||!1?1:-1;h.like_count=Math.max(0,(h.like_count||0)-I)}}}async function V(i){try{if(!i.id)return;const f=`${window.location.origin}/writing/${i.slug}`;await navigator.clipboard.writeText(f);const h=i.share_count||0,w=h+1;i.share_count=w,console.log(`Optimistic update - share count for essay ${i.id}: ${h} → ${w}`),r(3,c="URL copied to clipboard!"),r(4,l=i.id),u&&clearTimeout(u),u=setTimeout(()=>{r(3,c=""),r(4,l="")},3e3),await Ge(i.id);try{const E=await ye(i.id);console.log(`Database counts for essay ${i.id}:`,E),r(0,n=n.map(I=>I.id===i.id?{...I,like_count:E.likeCount,share_count:E.shareCount,view_count:E.viewCount}:I))}catch(E){console.error("Error refreshing essay counts:",E)}}catch(f){console.error("Error sharing essay:",f),t("error",f),r(3,c="Failed to copy URL"),r(4,l=i.id),u=setTimeout(()=>{r(3,c=""),r(4,l="")},3e3),i&&(i.share_count=Math.max(0,(i.share_count||0)-1))}}const J=()=>console.log("Essays data:",n||"None"),P=(i,f)=>{console.log("Like button clicked in list view for:",i.id),C(i.id)},U=(i,f)=>{console.log("Share button clicked in list view for:",i.id),V(i)};return o.$$.update=()=>{o.$$.dirty&257&&r(5,b=(n==null?void 0:n.reduce((i,f)=>{if(f.id){const h=`${ce.ESSAY}:${f.id}`;i[f.id]=(p==null?void 0:p.likes[h])||!1}return i},{}))||{})},[n,a,s,c,l,b,C,V,p,J,P,U]}class lt extends Le{constructor(e){super(),Se(this,e,st,ot,De,{})}}function at(o){let e,r,t={ctx:o,current:null,token:null,hasCatch:!1,pending:dt,then:ut,catch:ct,value:4,blocks:[,,,]};return Ke(Promise.resolve(o[3]()),t),{c(){e=B(),t.block.c()},l(n){e=B(),t.block.l(n)},m(n,a){D(n,e,a),t.block.m(n,t.anchor=a),t.mount=()=>e.parentNode,t.anchor=e,r=!0},p(n,a){o=n,Xe(t,o,a)},i(n){r||(S(t.block),r=!0)},o(n){for(let a=0;a<3;a+=1){const s=t.blocks[a];q(s)}r=!1},d(n){n&&d(e),t.block.d(n),t.token=null,t=null}}}function it(o){let e,r,t;function n(c,l){return c[1]>=Me?_t:ht}let a=n(o),s=a(o);return{c(){e=k("div"),r=k("p"),t=W(`There was an error loading the essays. 
          `),s.c(),this.h()},l(c){e=g(c,"DIV",{class:!0});var l=z(e);r=g(l,"P",{});var u=z(r);t=O(u,`There was an error loading the essays. 
          `),s.l(u),u.forEach(d),l.forEach(d),this.h()},h(){m(e,"class","error-message svelte-c611qv")},m(c,l){D(c,e,l),_(e,r),_(r,t),s.m(r,null)},p(c,l){a!==(a=n(c))&&(s.d(1),s=a(c),s&&(s.c(),s.m(r,null)))},i:y,o:y,d(c){c&&d(e),s.d()}}}function ct(o){return{c:y,l:y,m:y,p:y,i:y,o:y,d:y}}function ut(o){let e,r,t=o[4]&&ft(o);return{c(){t&&t.c(),e=B()},l(n){t&&t.l(n),e=B()},m(n,a){t&&t.m(n,a),D(n,e,a),r=!0},p(n,a){n[4]&&t.p(n,a)},i(n){r||(S(t),r=!0)},o(n){q(t),r=!1},d(n){n&&d(e),t&&t.d(n)}}}function ft(o){let e,r,t;var n=o[4].component;function a(s,c){return{}}return n&&(e=me(n,a()),e.$on("error",o[2])),{c(){e&&se(e.$$.fragment),r=B()},l(s){e&&ue(e.$$.fragment,s),r=B()},m(s,c){e&&le(e,s,c),D(s,r,c),t=!0},p(s,c){if(n!==(n=s[4].component)){if(e){Q();const l=e;q(l.$$.fragment,1,0,()=>{ae(l,1)}),Z()}n?(e=me(n,a()),e.$on("error",s[2]),se(e.$$.fragment),S(e.$$.fragment,1),le(e,r.parentNode,r)):e=null}},i(s){t||(e&&S(e.$$.fragment,s),t=!0)},o(s){e&&q(e.$$.fragment,s),t=!1},d(s){s&&d(r),e&&ae(e,s)}}}function dt(o){return{c:y,l:y,m:y,p:y,i:y,o:y,d:y}}function ht(o){let e;return{c(){e=W("Retrying...")},l(r){e=O(r,"Retrying...")},m(r,t){D(r,e,t)},d(r){r&&d(e)}}}function _t(o){let e;return{c(){e=W("Please try refreshing the page.")},l(r){e=O(r,"Please try refreshing the page.")},m(r,t){D(r,e,t)},d(r){r&&d(e)}}}function pt(o){let e,r,t,n,a,s='Thoughts about <span class="purple">Software.</span>',c,l,u=`<p>How do our natural behaviors and cognitive patterns uncover opportunities
      to rethink software design and create tools that <span class="small-font svelte-c611qv">quietly</span> complement our lives?</p>`,p,b,v,C,V;const J=[it,at],P=[];function U(i,f){return i[0]?0:1}return v=U(o),C=P[v]=J[v](o),{c(){e=k("meta"),r=k("link"),t=N(),n=k("main"),a=k("h2"),a.innerHTML=s,c=N(),l=k("div"),l.innerHTML=u,p=N(),b=k("div"),C.c(),this.h()},l(i){const f=Oe("svelte-hwnoeq",document.head);e=g(f,"META",{name:!0,content:!0}),r=g(f,"LINK",{rel:!0,href:!0}),f.forEach(d),t=A(i),n=g(i,"MAIN",{class:!0});var h=z(n);a=g(h,"H2",{class:!0,"data-svelte-h":!0}),X(a)!=="svelte-1l1gur7"&&(a.innerHTML=s),c=A(h),l=g(h,"DIV",{class:!0,"data-svelte-h":!0}),X(l)!=="svelte-1dyp2ll"&&(l.innerHTML=u),p=A(h),b=g(h,"DIV",{class:!0});var w=z(b);C.l(w),w.forEach(d),h.forEach(d),this.h()},h(){document.title="Writing | Wendy Ham's Weekend Projects",m(e,"name","description"),m(e,"content","Thoughts about creating software that quietly complements our lives."),m(r,"rel","canonical"),m(r,"href","https://xnham.com/writing"),m(a,"class","small-bottom-margin"),m(l,"class","writing-intro svelte-c611qv"),m(b,"class","essays-container svelte-c611qv"),m(n,"class","container")},m(i,f){_(document.head,e),_(document.head,r),D(i,t,f),D(i,n,f),_(n,a),_(n,c),_(n,l),_(n,p),_(n,b),P[v].m(b,null),V=!0},p(i,[f]){let h=v;v=U(i),v===h?P[v].p(i,f):(Q(),q(P[h],1,1,()=>{P[h]=null}),Z(),C=P[v],C?C.p(i,f):(C=P[v]=J[v](i),C.c()),S(C,1),C.m(b,null))},i(i){V||(S(C),V=!0)},o(i){q(C),V=!1},d(i){i&&(d(t),d(n)),d(e),d(r),P[v].d()}}}const Me=2;function mt(o,e,r){let t=!1,n=0;function a(c){console.error("Error in Essays component:",c.detail),r(0,t=!0),n<Me&&(r(1,n++,n),setTimeout(()=>{console.log(`Retry attempt ${n} for Essays component`),r(0,t=!1)},1e3))}function s(){try{return{component:lt,props:{}}}catch(c){return console.error("Error while preparing Essays component:",c),r(0,t=!0),null}}return Ie(()=>{Ue.set({title:"Writing | Wendy Ham's Weekend Projects",description:"Thoughts about creating software that quietly complements our lives.",canonicalUrl:"https://xnham.com/writing",type:"website",url:window.location.href});const c=l=>{console.error("Global error caught:",l.error||l.message);const u=String(l.error||l.message);(u.includes("Essays")||u.includes("essay")||u.includes("interaction"))&&(r(0,t=!0),l.preventDefault())};return window.addEventListener("error",c),()=>{window.removeEventListener("error",c)}}),[t,n,a,s]}class Tt extends Le{constructor(e){super(),Se(this,e,mt,pt,De,{})}}export{Tt as component,Ct as universal};
