import{S as He,T as Ne,U as oe,V as Pe,s as ze,f as k,g,h as D,d,j as m,i as z,W as Ae,o as Ie,e as B,M as Re,a as P,r as X,c as A,w as _,x as Fe,y,l as W,m as U,n as G,C as We,G as Ue,q as me}from"../chunks/scheduler.90cbc393.js";import{g as Q,t as H,c as Z,a as S,S as Le,i as Se,b as se,d as ue,m as le,e as ie,f as ve}from"../chunks/index.f2611f2d.js";import{m as Oe}from"../chunks/metadataStore.410d5ae1.js";import{e as ke}from"../chunks/each.23f806c3.js";import{f as ge}from"../chunks/index.f9edecbc.js";import{s as je}from"../chunks/supabase.8f09c013.js";import{I as be}from"../chunks/InteractionButton.c0953185.js";import{i as Be,s as Je,C as ce,t as Ye,g as ye,r as Ge}from"../chunks/essayInteractionService.153f6b7c.js";function Ke(o,e){const r=e.token={};function t(n,i,s,c){if(e.token!==r)return;e.resolved=c;let l=e.ctx;s!==void 0&&(l=l.slice(),l[s]=c);const u=n&&(e.current=n)(l);let p=!1;e.block&&(e.blocks?e.blocks.forEach((b,v)=>{v!==i&&b&&(Q(),H(b,1,1,()=>{e.blocks[v]===b&&(e.blocks[v]=null)}),Z())}):e.block.d(1),u.c(),S(u,1),u.m(e.mount(),e.anchor),p=!0),e.block=u,e.blocks&&(e.blocks[i]=u),p&&Pe()}if(He(o)){const n=Ne();if(o.then(i=>{oe(n),t(e.then,1,e.value,i),oe(null)},i=>{if(oe(n),t(e.catch,2,e.error,i),oe(null),!e.hasCatch)throw i}),e.current!==e.pending)return t(e.pending,0),!0}else{if(e.current!==e.then)return t(e.then,1,e.value,o),!0;e.resolved=o}}function Xe(o,e,r){const t=e.slice(),{resolved:n}=o;o.current===o.then&&(t[o.value]=n),o.current===o.catch&&(t[o.error]=n),o.block.p(t,r)}function we(o,e,r){const t=o.slice();return t[15]=e[r],t}function Qe(o){let e,r,t=ke(o[0]),n=[];for(let s=0;s<t.length;s+=1)n[s]=Ce(we(o,t,s));const i=s=>H(n[s],1,1,()=>{n[s]=null});return{c(){for(let s=0;s<n.length;s+=1)n[s].c();e=B()},l(s){for(let c=0;c<n.length;c+=1)n[c].l(s);e=B()},m(s,c){for(let l=0;l<n.length;l+=1)n[l]&&n[l].m(s,c);z(s,e,c),r=!0},p(s,c){if(c&249){t=ke(s[0]);let l;for(l=0;l<t.length;l+=1){const u=we(s,t,l);n[l]?(n[l].p(u,c),S(n[l],1)):(n[l]=Ce(u),n[l].c(),S(n[l],1),n[l].m(e.parentNode,e))}for(Q(),l=t.length;l<n.length;l+=1)i(l);Z()}},i(s){if(!r){for(let c=0;c<t.length;c+=1)S(n[c]);r=!0}},o(s){n=n.filter(Boolean);for(let c=0;c<n.length;c+=1)H(n[c]);r=!1},d(s){s&&d(e),Re(n,s)}}}function Ze(o){let e,r,t="No essays found. Please check your database connection or create some essays.",n,i,s,c="Debug Essays Data",l,u;return{c(){e=k("div"),r=k("p"),r.textContent=t,n=P(),i=k("div"),s=k("button"),s.textContent=c,this.h()},l(p){e=g(p,"DIV",{class:!0});var b=D(e);r=g(b,"P",{"data-svelte-h":!0}),X(r)!=="svelte-syp6t2"&&(r.textContent=t),n=A(b),i=g(b,"DIV",{class:!0});var v=D(i);s=g(v,"BUTTON",{class:!0,"data-svelte-h":!0}),X(s)!=="svelte-p33n27"&&(s.textContent=c),v.forEach(d),b.forEach(d),this.h()},h(){m(s,"class","svelte-11wzf28"),m(i,"class","debug-actions svelte-11wzf28"),m(e,"class","no-essays svelte-11wzf28")},m(p,b){z(p,e,b),_(e,r),_(e,n),_(e,i),_(i,s),l||(u=Fe(s,"click",o[9]),l=!0)},p:y,i:y,o:y,d(p){p&&d(e),l=!1,u()}}}function xe(o){let e,r,t;return{c(){e=k("div"),r=W("Error: "),t=W(o[2]),this.h()},l(n){e=g(n,"DIV",{class:!0});var i=D(e);r=U(i,"Error: "),t=U(i,o[2]),i.forEach(d),this.h()},h(){m(e,"class","error-state svelte-11wzf28")},m(n,i){z(n,e,i),_(e,r),_(e,t)},p(n,i){i&4&&G(t,n[2])},i:y,o:y,d(n){n&&d(e)}}}function et(o){let e,r="Loading essays...";return{c(){e=k("div"),e.textContent=r,this.h()},l(t){e=g(t,"DIV",{class:!0,"data-svelte-h":!0}),X(e)!=="svelte-14u9k9t"&&(e.textContent=r),this.h()},h(){m(e,"class","loading-state svelte-11wzf28")},m(t,n){z(t,e,n)},p:y,i:y,o:y,d(t){t&&d(e)}}}function tt(o){let e=o[15].description+"",r;return{c(){r=W(e)},l(t){r=U(t,e)},m(t,n){z(t,r,n)},p(t,n){n&1&&e!==(e=t[15].description+"")&&G(r,e)},d(t){t&&d(r)}}}function rt(o){let e=o[15].excerpt+"",r;return{c(){r=W(e)},l(t){r=U(t,e)},m(t,n){z(t,r,n)},p(t,n){n&1&&e!==(e=t[15].excerpt+"")&&G(r,e)},d(t){t&&d(r)}}}function Ee(o){let e,r,t,n;return{c(){e=k("div"),r=W(o[3]),this.h()},l(i){e=g(i,"DIV",{class:!0});var s=D(e);r=U(s,o[3]),s.forEach(d),this.h()},h(){m(e,"class","copy-feedback svelte-11wzf28")},m(i,s){z(i,e,s),_(e,r),n=!0},p(i,s){(!n||s&8)&&G(r,i[3])},i(i){n||(i&&We(()=>{n&&(t||(t=ve(e,ge,{duration:150},!0)),t.run(1))}),n=!0)},o(i){i&&(t||(t=ve(e,ge,{duration:150},!1)),t.run(0)),n=!1},d(i){i&&d(e),i&&t&&t.end()}}}function $e(o){let e=De(o[15])+"",r;return{c(){r=W(e)},l(t){r=U(t,e)},m(t,n){z(t,r,n)},p(t,n){n&1&&e!==(e=De(t[15])+"")&&G(r,e)},d(t){t&&d(r)}}}function Ce(o){let e,r,t,n,i=Te(o[15].date)+"",s,c,l,u=o[15].title+"",p,b,v,C,V,J='<span class="read-more-text svelte-11wzf28">Read more</span> &gt;',q,O,a,f,h,w,E,I,K,N,R,ae,Y;function fe(T,L){return T[15].excerpt?rt:tt}let ee=fe(o),F=ee(o);function Ve(...T){return o[10](o[15],...T)}h=new be({props:{type:"like",active:o[5][o[15].id]||!1,count:void 0}}),h.$on("click",Ve);function qe(...T){return o[11](o[15],...T)}I=new be({props:{type:"share",active:!1,count:void 0}}),I.$on("click",qe);let $=o[3]&&o[4]===o[15].id&&Ee(o),M=o[15].id&&$e(o);return{c(){e=k("div"),r=k("a"),t=k("div"),n=k("p"),s=W(i),c=P(),l=k("h3"),p=W(u),b=P(),v=k("p"),F.c(),C=P(),V=k("span"),V.innerHTML=J,O=P(),a=k("div"),f=k("div"),se(h.$$.fragment),w=P(),E=k("div"),se(I.$$.fragment),K=P(),$&&$.c(),N=P(),R=k("div"),M&&M.c(),ae=P(),this.h()},l(T){e=g(T,"DIV",{class:!0});var L=D(e);r=g(L,"A",{href:!0,class:!0,"data-sveltekit-preload-data":!0});var x=D(r);t=g(x,"DIV",{class:!0});var j=D(t);n=g(j,"P",{class:!0});var de=D(n);s=U(de,i),de.forEach(d),c=A(j),l=g(j,"H3",{class:!0});var he=D(l);p=U(he,u),he.forEach(d),b=A(j),v=g(j,"P",{class:!0});var _e=D(v);F.l(_e),_e.forEach(d),C=A(j),V=g(j,"SPAN",{class:!0,"data-svelte-h":!0}),X(V)!=="svelte-wq4u18"&&(V.innerHTML=J),j.forEach(d),x.forEach(d),O=A(L),a=g(L,"DIV",{class:!0});var te=D(a);f=g(te,"DIV",{class:!0});var re=D(f);ue(h.$$.fragment,re),w=A(re),E=g(re,"DIV",{class:!0});var ne=D(E);ue(I.$$.fragment,ne),K=A(ne),$&&$.l(ne),ne.forEach(d),re.forEach(d),N=A(te),R=g(te,"DIV",{class:!0});var pe=D(R);M&&M.l(pe),pe.forEach(d),te.forEach(d),ae=A(L),L.forEach(d),this.h()},h(){m(n,"class","essay-date svelte-11wzf28"),m(l,"class","essay-title svelte-11wzf28"),m(v,"class","essay-description"),m(V,"class","read-more svelte-11wzf28"),m(t,"class","essay-content svelte-11wzf28"),m(r,"href",q="/writing/"+o[15].slug),m(r,"class","essay-card-link svelte-11wzf28"),m(r,"data-sveltekit-preload-data","off"),m(E,"class","share-button-container svelte-11wzf28"),m(f,"class","essay-buttons svelte-11wzf28"),m(R,"class","essay-counters svelte-11wzf28"),m(a,"class","essay-interaction-container svelte-11wzf28"),m(e,"class","essay-card svelte-11wzf28")},m(T,L){z(T,e,L),_(e,r),_(r,t),_(t,n),_(n,s),_(t,c),_(t,l),_(l,p),_(t,b),_(t,v),F.m(v,null),_(t,C),_(t,V),_(e,O),_(e,a),_(a,f),le(h,f,null),_(f,w),_(f,E),le(I,E,null),_(E,K),$&&$.m(E,null),_(a,N),_(a,R),M&&M.m(R,null),_(e,ae),Y=!0},p(T,L){o=T,(!Y||L&1)&&i!==(i=Te(o[15].date)+"")&&G(s,i),(!Y||L&1)&&u!==(u=o[15].title+"")&&G(p,u),ee===(ee=fe(o))&&F?F.p(o,L):(F.d(1),F=ee(o),F&&(F.c(),F.m(v,null))),(!Y||L&1&&q!==(q="/writing/"+o[15].slug))&&m(r,"href",q);const x={};L&33&&(x.active=o[5][o[15].id]||!1),h.$set(x),o[3]&&o[4]===o[15].id?$?($.p(o,L),L&25&&S($,1)):($=Ee(o),$.c(),S($,1),$.m(E,null)):$&&(Q(),H($,1,1,()=>{$=null}),Z()),o[15].id?M?M.p(o,L):(M=$e(o),M.c(),M.m(R,null)):M&&(M.d(1),M=null)},i(T){Y||(S(h.$$.fragment,T),S(I.$$.fragment,T),S($),Y=!0)},o(T){H(h.$$.fragment,T),H(I.$$.fragment,T),H($),Y=!1},d(T){T&&d(e),F.d(),ie(h),ie(I),$&&$.d(),M&&M.d()}}}function nt(o){let e,r,t,n;const i=[et,xe,Ze,Qe],s=[];function c(l,u){return l[1]?0:l[2]?1:!l[0]||l[0].length===0?2:3}return r=c(o),t=s[r]=i[r](o),{c(){e=k("div"),t.c(),this.h()},l(l){e=g(l,"DIV",{class:!0});var u=D(e);t.l(u),u.forEach(d),this.h()},h(){m(e,"class","essays svelte-11wzf28")},m(l,u){z(l,e,u),s[r].m(e,null),n=!0},p(l,[u]){let p=r;r=c(l),r===p?s[r].p(l,u):(Q(),H(s[p],1,1,()=>{s[p]=null}),Z(),t=s[r],t?t.p(l,u):(t=s[r]=i[r](l),t.c()),S(t,1),t.m(e,null))},i(l){n||(S(t),n=!0)},o(l){H(t),n=!1},d(l){l&&d(e),s[r].d()}}}function Te(o){const[e,r,t]=o.split("-"),n=["January","February","March","April","May","June","July","August","September","October","November","December"],i=parseInt(r,10)-1,s=n[i],c=t.startsWith("0")?t.substring(1):t;return`${s} ${c}, ${e}`}function De(o){const e=o.like_count||0,r=o.share_count||0;return e===0&&r===0?"":e>0&&r===0?`${e} ${e===1?"like":"likes"}`:e===0&&r>0?`${r} ${r===1?"share":"shares"}`:`${e} ${e===1?"like":"likes"} & ${r} ${r===1?"share":"shares"}`}function ot(o,e,r){const t=Ae();let n=[],i=!0,s=null,c="",l="",u=null,p={likes:{},shares:{},views:{}},b={};async function v(){try{console.log("Loading essays from Supabase...");const{data:a,error:f}=await je.from("essays").select(`
          id, title, description, date, published, excerpt, slug,
          like_count, share_count, view_count
        `).eq("published",!0).order("date",{ascending:!1});if(f)throw f;console.log(`Successfully loaded ${(a==null?void 0:a.length)||0} essays from Supabase`),r(0,n=a||[]),r(1,i=!1)}catch(a){console.error("Error loading essays:",a),r(2,s=a instanceof Error?a.message:"Failed to load essays"),r(1,i=!1),t("error",a)}}Ie(()=>{console.log("Initializing interactions on Essays component");let a=()=>{},f=null;try{f=setTimeout(async()=>{try{const w=await Be();if(console.log("Interactions initialized with device ID:",w),!w){console.error("Failed to initialize interactions - no device ID returned"),t("error",new Error("Failed to initialize interactions"));return}await v(),a=Je(E=>{console.log("Interaction state updated",E),r(8,p=E)})}catch(w){console.error("Error during delayed interaction initialization:",w),t("error",w)}},300);const h=w=>{w.key==="Escape"&&(r(3,c=""),r(4,l=""))};return window.addEventListener("keydown",h),()=>{f&&clearTimeout(f),a(),window.removeEventListener("keydown",h),u&&clearTimeout(u)}}catch(h){return console.error("Error setting up Essays component:",h),t("error",h),()=>{f&&clearTimeout(f),a(),u&&clearTimeout(u)}}});async function C(a){console.log("handleLike called with essayId:",a);try{const f=n.find(N=>N.id===a);if(!f)return;const h=`${ce.ESSAY}:${a}`,E=(p==null?void 0:p.likes[h])||!1?-1:1,I=f.like_count||0,K=Math.max(0,I+E);f.like_count=K,console.log(`Optimistic update - like count for essay ${a}: ${I} → ${K}`),await Ye(a);try{const N=await ye(a);console.log(`Database counts for essay ${a}:`,N),r(0,n=n.map(R=>R.id===a?{...R,like_count:N.likeCount,share_count:N.shareCount,view_count:N.viewCount}:R))}catch(N){console.error("Error refreshing essay counts:",N)}}catch(f){console.error("Error toggling like:",f),t("error",f);const h=n.find(w=>w.id===a);if(h){const w=`${ce.ESSAY}:${a}`,I=(p==null?void 0:p.likes[w])||!1?1:-1;h.like_count=Math.max(0,(h.like_count||0)-I)}}}async function V(a){try{if(!a.id)return;const f=`${window.location.origin}/writing/${a.slug}`;await navigator.clipboard.writeText(f);const h=a.share_count||0,w=h+1;a.share_count=w,console.log(`Optimistic update - share count for essay ${a.id}: ${h} → ${w}`),r(3,c="URL copied to clipboard!"),r(4,l=a.id),u&&clearTimeout(u),u=setTimeout(()=>{r(3,c=""),r(4,l="")},3e3),await Ge(a.id);try{const E=await ye(a.id);console.log(`Database counts for essay ${a.id}:`,E),r(0,n=n.map(I=>I.id===a.id?{...I,like_count:E.likeCount,share_count:E.shareCount,view_count:E.viewCount}:I))}catch(E){console.error("Error refreshing essay counts:",E)}}catch(f){console.error("Error sharing essay:",f),t("error",f),r(3,c="Failed to copy URL"),r(4,l=a.id),u=setTimeout(()=>{r(3,c=""),r(4,l="")},3e3),a&&(a.share_count=Math.max(0,(a.share_count||0)-1))}}const J=()=>console.log("Essays data:",n||"None"),q=(a,f)=>{console.log("Like button clicked in list view for:",a.id),C(a.id)},O=(a,f)=>{console.log("Share button clicked in list view for:",a.id),V(a)};return o.$$.update=()=>{o.$$.dirty&257&&r(5,b=(n==null?void 0:n.reduce((a,f)=>{if(f.id){const h=`${ce.ESSAY}:${f.id}`;a[f.id]=(p==null?void 0:p.likes[h])||!1}return a},{}))||{})},[n,i,s,c,l,b,C,V,p,J,q,O]}class st extends Le{constructor(e){super(),Se(this,e,ot,nt,ze,{})}}function lt(o){let e,r,t={ctx:o,current:null,token:null,hasCatch:!1,pending:ft,then:ct,catch:at,value:4,blocks:[,,,]};return Ke(Promise.resolve(o[3]()),t),{c(){e=B(),t.block.c()},l(n){e=B(),t.block.l(n)},m(n,i){z(n,e,i),t.block.m(n,t.anchor=i),t.mount=()=>e.parentNode,t.anchor=e,r=!0},p(n,i){o=n,Xe(t,o,i)},i(n){r||(S(t.block),r=!0)},o(n){for(let i=0;i<3;i+=1){const s=t.blocks[i];H(s)}r=!1},d(n){n&&d(e),t.block.d(n),t.token=null,t=null}}}function it(o){let e,r,t;function n(c,l){return c[1]>=Me?ht:dt}let i=n(o),s=i(o);return{c(){e=k("div"),r=k("p"),t=W(`There was an error loading the essays. 
          `),s.c(),this.h()},l(c){e=g(c,"DIV",{class:!0});var l=D(e);r=g(l,"P",{});var u=D(r);t=U(u,`There was an error loading the essays. 
          `),s.l(u),u.forEach(d),l.forEach(d),this.h()},h(){m(e,"class","error-message svelte-c611qv")},m(c,l){z(c,e,l),_(e,r),_(r,t),s.m(r,null)},p(c,l){i!==(i=n(c))&&(s.d(1),s=i(c),s&&(s.c(),s.m(r,null)))},i:y,o:y,d(c){c&&d(e),s.d()}}}function at(o){return{c:y,l:y,m:y,p:y,i:y,o:y,d:y}}function ct(o){let e,r,t=o[4]&&ut(o);return{c(){t&&t.c(),e=B()},l(n){t&&t.l(n),e=B()},m(n,i){t&&t.m(n,i),z(n,e,i),r=!0},p(n,i){n[4]&&t.p(n,i)},i(n){r||(S(t),r=!0)},o(n){H(t),r=!1},d(n){n&&d(e),t&&t.d(n)}}}function ut(o){let e,r,t;var n=o[4].component;function i(s,c){return{}}return n&&(e=me(n,i()),e.$on("error",o[2])),{c(){e&&se(e.$$.fragment),r=B()},l(s){e&&ue(e.$$.fragment,s),r=B()},m(s,c){e&&le(e,s,c),z(s,r,c),t=!0},p(s,c){if(n!==(n=s[4].component)){if(e){Q();const l=e;H(l.$$.fragment,1,0,()=>{ie(l,1)}),Z()}n?(e=me(n,i()),e.$on("error",s[2]),se(e.$$.fragment),S(e.$$.fragment,1),le(e,r.parentNode,r)):e=null}},i(s){t||(e&&S(e.$$.fragment,s),t=!0)},o(s){e&&H(e.$$.fragment,s),t=!1},d(s){s&&d(r),e&&ie(e,s)}}}function ft(o){return{c:y,l:y,m:y,p:y,i:y,o:y,d:y}}function dt(o){let e;return{c(){e=W("Retrying...")},l(r){e=U(r,"Retrying...")},m(r,t){z(r,e,t)},d(r){r&&d(e)}}}function ht(o){let e;return{c(){e=W("Please try refreshing the page.")},l(r){e=U(r,"Please try refreshing the page.")},m(r,t){z(r,e,t)},d(r){r&&d(e)}}}function _t(o){let e,r,t,n,i,s='Thoughts about <span class="purple">Software.</span>',c,l,u=`<p>How do our natural behaviors and cognitive patterns uncover opportunities
      to rethink software design and create tools that <span class="small-font svelte-c611qv">quietly</span> complement our lives?</p>`,p,b,v,C,V;const J=[it,lt],q=[];function O(a,f){return a[0]?0:1}return v=O(o),C=q[v]=J[v](o),{c(){e=k("meta"),r=k("link"),t=P(),n=k("main"),i=k("h2"),i.innerHTML=s,c=P(),l=k("div"),l.innerHTML=u,p=P(),b=k("div"),C.c(),this.h()},l(a){const f=Ue("svelte-hwnoeq",document.head);e=g(f,"META",{name:!0,content:!0}),r=g(f,"LINK",{rel:!0,href:!0}),f.forEach(d),t=A(a),n=g(a,"MAIN",{class:!0});var h=D(n);i=g(h,"H2",{class:!0,"data-svelte-h":!0}),X(i)!=="svelte-1l1gur7"&&(i.innerHTML=s),c=A(h),l=g(h,"DIV",{class:!0,"data-svelte-h":!0}),X(l)!=="svelte-1dyp2ll"&&(l.innerHTML=u),p=A(h),b=g(h,"DIV",{class:!0});var w=D(b);C.l(w),w.forEach(d),h.forEach(d),this.h()},h(){document.title="Writing | Wendy Ham's Weekend Projects",m(e,"name","description"),m(e,"content","Thoughts about creating software that quietly complements our lives."),m(r,"rel","canonical"),m(r,"href","https://xnham.com/writing"),m(i,"class","small-bottom-margin"),m(l,"class","writing-intro svelte-c611qv"),m(b,"class","essays-container svelte-c611qv"),m(n,"class","container")},m(a,f){_(document.head,e),_(document.head,r),z(a,t,f),z(a,n,f),_(n,i),_(n,c),_(n,l),_(n,p),_(n,b),q[v].m(b,null),V=!0},p(a,[f]){let h=v;v=O(a),v===h?q[v].p(a,f):(Q(),H(q[h],1,1,()=>{q[h]=null}),Z(),C=q[v],C?C.p(a,f):(C=q[v]=J[v](a),C.c()),S(C,1),C.m(b,null))},i(a){V||(S(C),V=!0)},o(a){H(C),V=!1},d(a){a&&(d(t),d(n)),d(e),d(r),q[v].d()}}}const Me=2;function pt(o,e,r){let t=!1,n=0;function i(c){console.error("Error in Essays component:",c.detail),r(0,t=!0),n<Me&&(r(1,n++,n),setTimeout(()=>{console.log(`Retry attempt ${n} for Essays component`),r(0,t=!1)},1e3))}function s(){try{return{component:st,props:{}}}catch(c){return console.error("Error while preparing Essays component:",c),r(0,t=!0),null}}return Ie(()=>{Oe.set({title:"Writing | Wendy Ham's Weekend Projects",description:"Thoughts about creating software that quietly complements our lives.",canonicalUrl:"https://xnham.com/writing",type:"website",url:window.location.href});const c=l=>{console.error("Global error caught:",l.error||l.message);const u=String(l.error||l.message);(u.includes("Essays")||u.includes("essay")||u.includes("interaction"))&&(r(0,t=!0),l.preventDefault())};return window.addEventListener("error",c),()=>{window.removeEventListener("error",c)}}),[t,n,i,s]}class $t extends Le{constructor(e){super(),Se(this,e,pt,_t,ze,{})}}export{$t as component};
